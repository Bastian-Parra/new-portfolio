---
import { Icon } from "astro-icon/components";
const logo = "<bsty.${dev} />";
---

<nav
  id="navbar"
  class="fixed top-0 left-0 right-0 z-50 py-4 transition-all duration-300 ease-in-out"
>
  <div class="mx-auto max-w-3xl px-6 flex justify-between items-center">
    <span
      class="hover:cursor-pointer opacity-50 hover:opacity-100 transition-all font-mono"
      >{logo}</span
    >
    <ul class="flex gap-5 items-center">
      <li
        class="hover:cursor-pointer opacity-50 hover:opacity-100 transition-all"
      >
        <a href="https://www.linkedin.com/in/bastian-parra-dev/" target="_blank"
          ><Icon name="brand-linkedin" size={24} /></a
        >
      </li>
      <li
        class="hover:cursor-pointer opacity-50 hover:opacity-100 transition-all"
      >
        <a href="https://github.com/Bastian-Parra" target="_blank"
          ><Icon name="github" size={24} /></a
        >
      </li>
      <li
        class="hover:cursor-pointer opacity-50 hover:opacity-100 transition-all"
      >
        <button
          id="theme-toggle"
          aria-label="Toggle theme"
          class="cursor-pointer mt-1"
        >
          <Icon name="brightness-up" size={24} />
        </button>
      </li>
    </ul>
  </div>
</nav>

<script>
  // Función para obtener el tema actual
  function getTheme(): "dark" | "light" {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme") as "dark" | "light";
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  }

  // Función para actualizar el icono del botón
  function updateThemeIcon(theme: "dark" | "light") {
    const themeToggle = document.getElementById("theme-toggle");
    if (!themeToggle) return;

    const svg = themeToggle.querySelector("svg");
    if (!svg) return;

    // Cambiar el icono: luna para modo claro, sol para modo oscuro
    if (theme === "dark") {
      svg.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brightness-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 12a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M12 5l0 -2" /><path d="M17 7l1.4 -1.4" /><path d="M19 12l2 0" /><path d="M17 17l1.4 1.4" /><path d="M12 19l0 2" /><path d="M7 17l-1.4 1.4" /><path d="M6 12l-2 0" /><path d="M7 7l-1.4 -1.4" /></svg>';
    } else {
      svg.innerHTML =
        '<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/>';
    }
  }

  // Función para aplicar el tema
  function applyTheme(theme: "dark" | "light") {
    if (theme === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
    localStorage.setItem("theme", theme);
    updateThemeIcon(theme);
  }

  // Aplicar tema inicial
  applyTheme(getTheme());

  // Toggle del tema
  const themeToggle = document.getElementById("theme-toggle");
  themeToggle?.addEventListener("click", () => {
    const currentTheme = getTheme();
    const newTheme = currentTheme === "dark" ? "light" : "dark";
    applyTheme(newTheme);
  });

  // Navbar scroll effect
  const navbar = document.getElementById("navbar");
  let lastScroll = 0;

  function handleScroll() {
    const currentScroll = window.scrollY;

    if (navbar) {
      if (currentScroll > 50) {
        // Cuando el usuario hace scroll hacia abajo
        navbar.classList.add(
          "backdrop-blur-md",
          "bg-background/80",
          "shadow-lg",
          "border-b",
          "border-[#202020]",
          "border-dotted",
        );
      } else {
        // Cuando está en la parte superior
        navbar.classList.remove(
          "backdrop-blur-md",
          "bg-background/80",
          "shadow-lg",
          "border-b",
          "border-borders/20",
        );
      }
    }

    lastScroll = currentScroll;
  }

  // Escuchar el evento de scroll
  window.addEventListener("scroll", handleScroll);

  // Ejecutar una vez al cargar para aplicar el estado inicial
  handleScroll();
</script>
